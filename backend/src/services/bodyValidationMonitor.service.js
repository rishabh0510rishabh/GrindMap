class BodyValidationMonitor {
  constructor() {\n    this.stats = {\n      totalRequests: 0,\n      rejectedRequests: 0,\n      avgBodySize: 0,\n      maxBodySize: 0,\n      maliciousAttempts: 0,\n      parseTimeouts: 0\n    };\n    \n    this.recentRequests = [];\n    this.maxHistory = 1000;\n  }\n\n  trackRequest(size, rejected = false, malicious = false, parseTime = 0) {\n    this.stats.totalRequests++;\n    \n    if (rejected) {\n      this.stats.rejectedRequests++;\n    }\n    \n    if (malicious) {\n      this.stats.maliciousAttempts++;\n    }\n    \n    if (parseTime > 1000) {\n      this.stats.parseTimeouts++;\n    }\n    \n    // Update size stats\n    this.stats.maxBodySize = Math.max(this.stats.maxBodySize, size);\n    this.stats.avgBodySize = (\n      (this.stats.avgBodySize * (this.stats.totalRequests - 1) + size) / \n      this.stats.totalRequests\n    );\n    \n    // Store recent request\n    this.recentRequests.push({\n      timestamp: Date.now(),\n      size,\n      rejected,\n      malicious,\n      parseTime\n    });\n    \n    // Trim history\n    if (this.recentRequests.length > this.maxHistory) {\n      this.recentRequests.shift();\n    }\n  }\n\n  getStats() {\n    const rejectionRate = this.stats.totalRequests > 0 \n      ? (this.stats.rejectedRequests / this.stats.totalRequests * 100).toFixed(2)\n      : '0.00';\n    \n    const maliciousRate = this.stats.totalRequests > 0\n      ? (this.stats.maliciousAttempts / this.stats.totalRequests * 100).toFixed(2)\n      : '0.00';\n    \n    return {\n      ...this.stats,\n      rejectionRate: `${rejectionRate}%`,\n      maliciousRate: `${maliciousRate}%`,\n      avgBodySizeKB: Math.round(this.stats.avgBodySize / 1024),\n      maxBodySizeKB: Math.round(this.stats.maxBodySize / 1024),\n      recentRequestsCount: this.recentRequests.length\n    };\n  }\n\n  getRecentActivity(minutes = 5) {\n    const cutoff = Date.now() - (minutes * 60 * 1000);\n    return this.recentRequests.filter(req => req.timestamp > cutoff);\n  }\n\n  reset() {\n    this.stats = {\n      totalRequests: 0,\n      rejectedRequests: 0,\n      avgBodySize: 0,\n      maxBodySize: 0,\n      maliciousAttempts: 0,\n      parseTimeouts: 0\n    };\n    this.recentRequests = [];\n  }\n}\n\nexport const bodyValidationMonitor = new BodyValidationMonitor();